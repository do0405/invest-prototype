# 통합 포트폴리오 관리 시스템

이 시스템은 long_short_portfolio의 6개 전략과 portfolio_management를 연결하여 자동화된 포트폴리오 관리를 제공합니다.

## 주요 기능

### 🎯 전략 통합
- **Strategy 1, 3, 5**: 롱 포지션 (매수 전략)
- **Strategy 2, 4, 6**: 숏 포지션 (매도 전략)
- 각 전략의 스크리닝 결과를 자동으로 포트폴리오에 반영

### 📊 포지션 관리
- **실시간 포지션 추적**: 모든 활성 포지션의 현재 상태 모니터링
- **손절매 자동 실행**: 각 전략에서 지정한 손절매 가격 도달 시 자동 청산
- **차익실현 자동 실행**: 목표 수익률 달성 시 자동 청산
- **트레일링 스톱**: 수익 보호를 위한 동적 손절매 조정

### 💰 리스크 관리
- **포지션 크기 제한**: 전략별 최대 포지션 크기 관리
- **총 자본 대비 위험도 관리**: 포지션당 2% 위험 한도
- **다양화**: 최대 10개 포지션으로 분산 투자

### 📈 성과 추적
- **일일 수익률 계산**: 포트폴리오 전체 성과 추적
- **전략별 성과 분석**: 각 전략의 기여도 분석
- **자동 리포트 생성**: 일일 포트폴리오 상태 리포트

## 파일 구조

```
long_short_portfolio/
├── portfolio_integration.py          # 핵심 통합 시스템
├── run_integrated_portfolio.py      # 실행 스크립트
├── strategy1.py ~ strategy6.py      # 개별 전략 (기존)
└── README_INTEGRATION.md            # 이 파일
```

## 사용법

### 1. 간단한 실행
```bash
cd long_short_portfolio
python run_integrated_portfolio.py
```

### 2. 프로그래밍 방식 사용
```python
from portfolio_integration import StrategyPortfolioIntegrator

# 시스템 초기화
integrator = StrategyPortfolioIntegrator(initial_capital=100000)

# 일일 사이클 실행
integrator.run_daily_cycle()
```

### 3. 개별 기능 사용
```python
# 모든 전략 실행
integrator.run_all_strategies()

# 포지션 업데이트
integrator.update_positions()

# 리포트 생성
integrator.generate_daily_report()
```

## 실행 모드

### 🔄 일일 사이클
1. **전략 실행**: 모든 전략(1~6) 스크리닝 실행
2. **결과 로드**: 각 전략의 스크리닝 결과 수집
3. **주문 생성**: 새로운 투자 기회에 대한 주문 생성
4. **포지션 업데이트**: 기존 포지션의 손익 및 리스크 체크
5. **자동 청산**: 손절매/차익실현 조건 충족 시 자동 실행
6. **리포트 생성**: 일일 성과 및 포지션 상태 리포트

### ⏰ 스케줄링
- **시장 개장 시**: 평일 오전 9:30
- **시장 마감 후**: 평일 오후 4:00
- 자동으로 일일 사이클 실행

## 주요 개선사항

### ✅ 기존 대비 개선된 점
1. **통합 관리**: 6개 전략을 하나의 시스템에서 관리
2. **자동화**: 수동 개입 없이 포지션 관리 자동화
3. **실시간 추적**: 포지션 상태 실시간 모니터링
4. **리스크 관리**: 체계적인 손절매 및 포지션 크기 관리
5. **성과 분석**: 통합된 성과 추적 및 리포트

### 🗑️ 제거된 기능
- **개별 전략의 track_portfolio 함수**: 통합 시스템으로 대체
- **분산된 포트폴리오 파일 관리**: 중앙 집중식 관리로 변경
- **수동 리포팅**: 자동 리포트 생성으로 대체

## 설정 옵션

### 💰 자본금 설정
```python
# 기본값: $100,000
integrator = StrategyPortfolioIntegrator(initial_capital=100000)
```

### 📊 리스크 매개변수
- **포지션당 위험도**: 총 자본의 2%
- **최대 포지션 수**: 10개
- **트레일링 스톱 거리**: 3%
- **트레일링 스톱 활성화**: 5% 수익 시

### 📁 결과 파일 위치
- **매수 전략 결과**: `results_ver2/buy/`
- **매도 전략 결과**: `results_ver2/sell/`
- **일일 리포트**: `results_ver2/daily_report_YYYYMMDD.txt`

## 모니터링

### 📊 실시간 상태 확인
```python
# 활성 포지션 확인
print(f"활성 포지션: {len(integrator.active_positions)}개")

# 완료된 포지션 확인
print(f"완료된 포지션: {len(integrator.position_history)}개")
```

### 📈 성과 확인
- 일일 리포트에서 총 수익률, 일일 수익률 확인
- 전략별 기여도 분석
- 개별 포지션 손익 추적

## 주의사항

⚠️ **백테스팅 시스템**: 이 시스템은 과거 데이터를 기반으로 한 백테스팅 시스템입니다.

⚠️ **실제 거래 주의**: 실제 거래에 사용하기 전에 충분한 테스트와 검증이 필요합니다.

⚠️ **데이터 의존성**: 정확한 주가 데이터가 필요하며, 데이터 품질이 결과에 영향을 줍니다.

## 문제 해결

### 🔧 일반적인 문제
1. **모듈 임포트 오류**: Python 경로 설정 확인
2. **데이터 파일 없음**: `data/us/` 디렉토리에 CSV 파일 확인
3. **권한 오류**: 결과 디렉토리 쓰기 권한 확인

### 📞 지원
- 로그 파일 확인: 콘솔 출력에서 오류 메시지 확인
- 디버그 모드: 상세한 로그를 위해 예외 처리 부분 확인