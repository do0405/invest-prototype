# Mark Minervini 스크리닝 알고리즘 분석 보고서

## 📊 스크리닝 조건 분석

### 조건 1~8 정의

**조건 1**: 현재 주가 > 150일 이동평균 > 200일 이동평균
- 코드: `latest['close'] > latest['ma150'] > latest['ma200']`
- 목적: 장기 상승 추세 확인

**조건 2**: 150일 이동평균이 상승 추세 (60일 전 대비)
- 코드: `latest['ma150'] > df.iloc[days_ago_60]['ma150']`
- 목적: 중장기 추세의 지속성 확인

**조건 3**: 200일 이동평균이 상승 추세 (20일 전 대비)
- 코드: `latest['ma200'] > df.iloc[days_ago_20]['ma200']`
- 목적: 장기 추세의 지속성 확인

**조건 4**: 현재 주가 > 50일 이동평균
- 코드: `latest['close'] > latest['ma50']`
- 목적: 중기 상승 추세 확인

**조건 5**: 현재 주가 >= 52주 최저가 × 1.3
- 코드: `latest['close'] >= latest['low_52w'] * 1.3`
- 목적: 저점 대비 충분한 상승 확인

**조건 6**: 현재 주가 >= 52주 최고가 × 0.75
- 코드: `latest['close'] >= latest['high_52w'] * 0.75`
- 목적: 고점 근처 유지 확인

**조건 7**: 현재 주가 > 20일 이동평균
- 코드: `latest['close'] > latest['ma20']`
- 목적: 단기 상승 추세 확인

**조건 8**: RS 점수 >= 85
- 코드: `result_df['rs_score'] >= 85`
- 목적: 시장 대비 상대적 강도 확인

## 🔍 RS 점수 계산 분석

### RS 점수 계산 방식

1. **Fred6724의 TradingView 기반 알고리즘 사용**
   - 3개월(63일), 6개월(126일), 9개월(189일), 12개월(252일) 수익률 계산
   - 가중치: 40% (3개월) + 20% (6개월) + 20% (9개월) + 20% (12개월)

2. **벤치마크 대비 상대 강도**
   ```python
   # 개별 종목 점수
   p3 = (close[-1] - close[-63]) / close[-63] * 100
   p6 = (close[-1] - close[-126]) / close[-126] * 100
   p9 = (close[-1] - close[-189]) / close[-189] * 100
   p12 = (close[-1] - close[-252]) / close[-252] * 100
   stock_score = 0.4 * p3 + 0.2 * p6 + 0.2 * p9 + 0.2 * p12
   
   # SPY 벤치마크 점수 (동일 방식)
   rs_score = stock_score / bench_score * 100
   ```

3. **백분위 변환**
   - `percentileofscore(rs_score_values, score, kind="rank")`
   - 모든 종목 중 상대적 순위를 0-100 점수로 변환

### 메모리 최적화 및 안정성

- **청크 단위 처리**: 100개 종목씩 분할 처리로 메모리 사용량 제한
- **가비지 컬렉션**: 2개 청크마다 강제 메모리 정리
- **오류 처리**: 개별 종목 오류가 전체 계산에 영향 주지 않음

## ✅ 검증 결과

### 조건 계산 정확성

**검증 방법**: WW 종목 및 하위 10개 종목 직접 계산 검증

**WW 종목 예시** (RS: 99.98):
- 현재가: $42.31
- MA150: $5.43, MA200: $4.38
- 조건1: ✅ (42.31 > 5.43 > 4.38)
- 조건2: ✅ (MA150 상승: 5.43 > 0.93)
- 조건3: ✅ (MA200 상승: 4.38 > 0.80)
- 조건4: ✅ (42.31 > 14.85)
- 조건5: ✅ (42.31 >= 0.15)
- 조건6: ✅ (42.31 >= 35.21)
- 조건7: ✅ (42.31 > 36.70)
- 조건8: ✅ (RS 99.98 >= 85)

**하위 10개 종목 검증 결과**:
- 모든 종목이 실제로 8개 조건 모두 만족
- 계산된 met_count와 CSV 파일의 값 일치
- RS 점수 85 미만인 종목 0개 (모든 종목이 조건 8 만족)

### 필터링 로직 정확성

```python
# 모든 조건을 만족하는 종목만 필터링
conditions = [f'cond{i}' for i in range(1, 9)]  # cond1부터 cond8까지
filtered_df = result_df[result_df[conditions].all(axis=1)]
```

- **전체 스크리닝 결과**: 418개 종목
- **모든 조건 만족**: 418개 종목 (100%)
- **RS 점수 범위**: 85.06 ~ 99.98

## 🚨 잠재적 이슈 분석

### 1. 데이터 품질 이슈

**WW 종목 데이터 이상**:
- 2025년 6월 25일~7월 6일: 거래량 0, 가격 고정 ($0.307)
- 2025년 7월 7일: 급격한 가격 상승 ($0.307 → $40.00)
- 이러한 데이터 이상이 이동평균 계산에 영향을 줄 수 있음

### 2. RS 점수 계산의 정확성

**병렬 처리 안전성**:
- 청크 단위 처리로 메모리 경합 해결
- 가비지 컬렉션으로 메모리 누수 방지
- 개별 종목 오류가 전체에 영향 주지 않음

**벤치마크 의존성**:
- SPY 데이터 부족 시 전체 RS 계산 실패 가능
- 현재는 252일 이상 데이터 필요

### 3. 조건 계산의 엄격성

**현재 구현의 특징**:
- 모든 조건을 엄격하게 적용
- 데이터 부족 시 해당 종목 제외
- 오류 발생 시 안전한 기본값 사용

## 📈 결론

### 스크리닝 알고리즘의 신뢰성

1. **조건 계산 정확성**: ✅ 검증 완료
2. **RS 점수 계산**: ✅ 메모리 최적화 및 안정성 확보
3. **필터링 로직**: ✅ 모든 조건 만족 종목만 선별
4. **데이터 처리**: ✅ 오류 처리 및 예외 상황 대응

### 현재 결과의 타당성

- **418개 종목 모두 8개 조건 만족**: 정상
- **RS 점수 85 이상**: 조건 8에 의한 자연스러운 결과
- **조건별 계산 정확성**: 직접 검증으로 확인

### 권장사항

1. **데이터 품질 모니터링**: 거래량 0, 가격 고정 등 이상 데이터 감지
2. **RS 점수 임계값 조정**: 필요시 85에서 다른 값으로 변경 고려
3. **조건 완화**: 일부 조건을 선택적으로 적용하는 옵션 추가
4. **백테스팅**: 과거 데이터로 스크리닝 성과 검증

---

**분석 일시**: 2025년 8월 1일  
**분석 대상**: Mark Minervini 스크리너 (us_with_rs.csv)  
**검증 종목**: WW 및 하위 10개 종목